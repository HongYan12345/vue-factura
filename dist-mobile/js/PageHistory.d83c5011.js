import{M as A,a3 as T,Q as J,a4 as I,S as R,r as H,t as V,b as E,O as j,u as P,e as q,R as L,o as z,H as M,a5 as Q,f as U,g as y,h as F,j as u,k as o,w as d,q as l,s as b,l as D}from"./index.8520ca77.js";import{g as G,d as K}from"./dbFirebase.c19da40e.js";const W=A({components:{CopyOutlined:T,DeleteOutlined:J,LoadingOutlined:I,SearchOutlined:R},setup(){const t=H({isLoading:!0}),p=V(t),i=E(""),{t:N,locale:w}=j(),f=P(),s=q(),r=E([]),_=L(()=>i.value?r.value.filter(e=>e.factura_date.includes(i.value)||e.factura_num.toString().includes(i.value)||JSON.parse(e.user).name.includes(i.value)):r.value),m=()=>{r.value=[],s.state.isVisitor?M().then(e=>{console.log("[PageHistory]factura en base de dato:",e),e.forEach(a=>{r.value.push(a)}),t.isLoading=!1}):G("facturas").then(e=>{console.log("[PageHistory]factura en FireBase:",e),e.forEach(a=>{r.value.push(a)}),t.isLoading=!1}).catch(e=>{console.error("Error getting data: ",e)})},S=L(()=>[..._.value].sort((a,n)=>{const h=new Date(a.factura_date.split("/").reverse().join("-")).getTime(),O=new Date(n.factura_date.split("/").reverse().join("-")).getTime();return h==O?Number(n.factura_num)-Number(a.factura_num):O-h})),k=()=>{C(),f.back()},C=()=>{s.commit("RESET_STATE")},v=e=>{const a=JSON.parse(e.empresa),n=JSON.parse(e.euro_final),h=JSON.parse(e.item_list),O=JSON.parse(e.user);console.log(n),s.commit("saveCliente",O),s.commit("saveData",{dataArray:h,euroBase:n.total,dto:n.dto,isRe:n.re!=0,isIva:n.iva!=0}),s.commit("saveFinal",n),s.commit("saveEmpresa",a),s.commit("saveNum",{num:e.factura_num,date:e.factura_date,forma:e.forma})},c=e=>{v(e),f.push({name:"pdf",params:{history:1}})},g=e=>{v(e),f.push({name:"company"})},B=e=>{K("facturas",e.factura_num+e.factura_date.split("/")[2]).then(a=>{console.log("delect success")}).catch(a=>{console.error("Error getting data: ",a)}),Q(e.id).then(a=>{console.log("delect success")}).catch(a=>{console.error("Error getting data: ",a)}),m()},$=e=>{const a=JSON.parse(e.user);return"Nº: "+e.factura_num+", "+e.factura_date+", "+a.name};return z(()=>{m()}),{...p,t:N,factura_list:r,goBack:k,parsedItem:$,goFactura:c,newFactura:g,sortedFacturaList:S,deletFactura:B,filteredClients:_,searchString:i}}}),X={class:"button-container"},Y={key:0},Z={key:1},x={class:"item-row"},ee=["onClick"];function ae(t,p,i,N,w,f){const s=l("a-button"),r=l("LoadingOutlined"),_=l("SearchOutlined"),m=l("a-input"),S=l("CopyOutlined"),k=l("DeleteOutlined"),C=l("a-list-item"),v=l("a-list");return y(),F("div",null,[u("div",X,[o(s,{onClick:t.goBack,class:"btn-back",size:"large"},{default:d(()=>[b(D(t.$t("back")),1)]),_:1},8,["onClick"])]),t.isLoading?(y(),F("div",Y,[u("div",null,[o(r)])])):(y(),F("div",Z,[u("div",null,[o(m,{class:"search-input",placeholder:"Search",value:t.searchString,"onUpdate:value":p[0]||(p[0]=c=>t.searchString=c)},{suffix:d(()=>[o(_)]),_:1},8,["value"])]),o(v,{class:"a-list","item-layout":"horizontal","data-source":t.sortedFacturaList,locale:{emptyText:" "}},{renderItem:d(({item:c})=>[o(C,null,{default:d(()=>[u("div",x,[u("a",{class:"item-details",onClick:g=>t.goFactura(c)},[u("div",null,[u("div",null,D(t.parsedItem(c)),1)])],8,ee),o(s,{onClick:g=>t.newFactura(c)},{default:d(()=>[o(S)]),_:2},1032,["onClick"]),b("   "),o(s,{onClick:g=>t.deletFactura(c)},{default:d(()=>[o(k)]),_:2},1032,["onClick"])])]),_:2},1024)]),_:1},8,["data-source"])]))])}const oe=U(W,[["render",ae]]);export{oe as default};
