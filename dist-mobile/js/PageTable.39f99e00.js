import{P as M,r as j,t as Y,R as D,u as Z,e as G,O as H,b as R,o as J,I as K,f as Q,g,h as y,j as r,k as e,w as a,F as W,q as p,s as d,l as n,Y as z,p as O,Z as X,$,a0 as oo}from"./index.8520ca77.js";import{g as eo}from"./dbFirebase.c19da40e.js";const ao={components:{PlusOutlined:M},setup(){const o=j({total:0,iva:0,re:0,total_euros:0,dto:0,ante_euro:0,isRe:!1,isIva:!1,add_producto:!1,cantidad:"",codigo:"",precio:"",articulo:"",isEdit:""}),c=Y(o),x=D({get:()=>o.dto===0?"":o.dto,set:t=>{o.dto=t===""?0:Number(t)}}),l=Z(),f=G(),{t:E,locale:m}=H(),_=R([]),i=D(()=>_.value.length+1),u=R(!1),b=R([]),I=()=>{o.isRe=!o.isRe,v()},F=()=>{o.isIva=!o.isIva,v()},v=()=>{console.log("[PageTable]funcion calcula"),o.total=0;for(const t of _.value)o.total+=t.euros;o.dto<0&&(o.dto=0),o.isIva?o.iva=Number((o.total*(100-o.dto)*.01*.21).toFixed(2)):o.iva=0,o.isRe?o.re=Number((o.total*(100-o.dto)*.01*.052).toFixed(2)):o.re=0,o.total_euros=Number((o.total*(100-o.dto)*.01+o.iva+o.re).toFixed(2))},P=()=>{_.value=new Array,o.total=0,v()},C=()=>{o.add_producto=!0,o.isEdit="",o.cantidad="",o.codigo="",o.precio="",o.articulo=""},k=t=>{o.add_producto=!0,o.cantidad=t.cantidad,o.precio=t.precio,o.codigo=t.codigo,o.articulo=t.articulo,o.isEdit=t.key,o.ante_euro=t.euros},N=t=>{o.add_producto=!1,o.isEdit="",o.cantidad="",o.codigo="",o.precio="",o.articulo="",_.value=_.value.filter(h=>h.codigo!==t),v()},A=()=>{if(u.value=!0,o.isEdit!=""){for(const t of _.value)if(t.key===o.isEdit){t.cantidad=o.cantidad,t.precio=Number(o.precio).toFixed(2),t.codigo=o.codigo,t.articulo=o.articulo,t.euros=Number(o.cantidad)*Number(o.precio);break}o.isEdit=""}else{const t={key:`${i.value}`,cantidad:o.cantidad,codigo:o.codigo,precio:Number(o.precio).toFixed(2),articulo:o.articulo,euros:Number((Number(o.cantidad)*Number(o.precio)).toFixed(2))};_.value.push(t)}o.add_producto=!1,v(),o.cantidad="",o.codigo="",o.precio="",o.articulo="",console.log("[PageTable]producto saved"),u.value=!1},s=()=>{f.state.isVisitor?K().then(t=>{console.log("[PageTable]articulo en base de dato:",t),t.forEach(h=>{b.value.push({value:h.name})})}):eo("articulos").then(t=>{console.log("[PageTable]articulo en FireBase:",t),t.forEach(h=>{b.value.push({value:h.name})})}).catch(t=>{console.error("Error getting data: ",t)})},T=()=>{o.precio=o.precio.replace(/,|，/g,".")},U=()=>{o.precio=o.precio.replace(/[^0-9.,，]/g,"")},V=()=>{o.precio=o.precio.replace(/[^0-9]/g,"")},w=()=>{console.log("[PageTable]funcion pageUpdate"),s(),v(),B()},q=()=>{w(),l.push({name:"pdf",params:{history:0}})},B=()=>{f.commit("saveData",{dataArray:_.value,euroBase:o.total.toFixed(2),dto:o.dto,isRe:o.isRe,isIva:o.isIva}),f.commit("saveFinal",{total:o.total.toFixed(2),dto:o.dto,base:(o.total-o.dto).toFixed(2),iva:o.iva.toFixed(2),re:o.re.toFixed(2),total_final:o.total_euros.toFixed(2)})},L=()=>{B(),l.back()};return J(()=>{console.log("[PageTable]funcion onMounted"),o.dto=f.state.dto,_.value=f.state.dataArray,o.total=f.state.euroBase,o.isRe=f.state.isRe,o.isIva=f.state.isIva,v(),w()}),{...c,t:E,displayDto:x,dataSource:_,checkIva:F,checkRe:I,calcula:v,goBack:L,addProducto:C,saveProducto:A,deleteProducto:N,editProducto:k,clearTable:P,checkInput:T,validatePrecioInput:U,validateNumberInput:V,confirmLoading:u,goPdf:q,articulo_list:b}}};const S=o=>($("data-v-b5222c02"),o=o(),oo(),o),to={class:"button-container"},lo={style:{"margin-left":"0"}},so=S(()=>r("div",{class:"space"},null,-1)),no={key:0},io={key:1},co={key:2},ro={key:3},uo=S(()=>r("div",{class:"space"},null,-1)),po={class:"large-font"},_o={class:"item-row"},vo=["onClick"],fo={class:"list-font"},go={class:"button-container"};function mo(o,c,x,l,f,E){const m=p("a-button"),_=p("a-input-number"),i=p("a-col"),u=p("a-row"),b=p("a-checkbox"),I=p("a-collapse-panel"),F=p("a-collapse"),v=p("PlusOutlined"),P=p("a-list-item"),C=p("a-list"),k=p("a-input"),N=p("a-select"),A=p("a-modal");return g(),y(W,null,[r("div",to,[e(m,{onClick:l.goBack,class:"btn-back",size:"large"},{default:a(()=>[d(n(o.$t("back")),1)]),_:1},8,["onClick"]),e(m,{onClick:l.goPdf,class:"btn-next",size:"large"},{default:a(()=>[d(n(o.$t("next")),1)]),_:1},8,["onClick"])]),e(F,{bordered:!1,class:"collapse-total"},{default:a(()=>[e(I,null,{header:a(()=>[r("div",lo,[r("span",null,n(o.$t("total_euro")),1)]),so,r("div",null,[o.isIva?(g(),y("div",no,"con iva")):(g(),y("div",io,"sin iva")),o.isRe?(g(),y("div",co,"con re")):(g(),y("div",ro,"sin re"))]),uo,r("div",po,[r("span",null,n(o.total_euros.toFixed(2))+"€",1)])]),default:a(()=>[e(u,{gutter:16},{default:a(()=>[e(i,{xs:18,sm:12,md:12,lg:6},{default:a(()=>[e(_,{size:"small",style:{"padding-bottom":"8px"},value:l.displayDto,"onUpdate:value":c[0]||(c[0]=s=>l.displayDto=s),onChange:l.calcula,"addon-before":"DTO",min:0,max:99},{default:a(()=>[d("%")]),_:1},8,["value","onChange"])]),_:1})]),_:1}),e(u,null,{default:a(()=>[e(i,{span:12},{default:a(()=>[d("  Total:")]),_:1}),e(i,{span:12,class:"text-right"},{default:a(()=>[d(n(o.total.toFixed(2)),1)]),_:1})]),_:1}),o.dto>0?(g(),z(u,{key:0},{default:a(()=>[e(i,{span:12},{default:a(()=>[d("  "+n(o.dto)+"%DTO:",1)]),_:1}),e(i,{span:12,class:"text-right"},{default:a(()=>[d(" -"+n(Number(o.total*.01*o.dto).toFixed(2)),1)]),_:1})]),_:1})):O("",!0),e(u,null,{default:a(()=>[e(i,{span:12},{default:a(()=>[d("  "),e(b,{checked:o.isIva,onClick:l.checkIva},{default:a(()=>[d("+21%IVA")]),_:1},8,["checked","onClick"])]),_:1}),e(i,{span:12,class:"text-right"},{default:a(()=>[d(n(o.iva.toFixed(2)),1)]),_:1})]),_:1}),e(u,null,{default:a(()=>[e(i,{span:12},{default:a(()=>[d("  "),e(b,{checked:o.isRe,onClick:l.checkRe},{default:a(()=>[d("+5.2%R.E.")]),_:1},8,["checked","onClick"])]),_:1}),e(i,{span:12,class:"text-right"},{default:a(()=>[d(n(o.re.toFixed(2)),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(u,null,{default:a(()=>[e(i,{span:24},{default:a(()=>[e(m,{onClick:l.addProducto,class:"btn-add",type:"text",block:""},{icon:a(()=>[e(v,{style:{"font-size":"20px"}})]),_:1},8,["onClick"]),e(C,{class:"a-list","item-layout":"horizontal","data-source":l.dataSource,locale:{emptyText:" "}},{renderItem:a(({item:s})=>[e(P,null,{default:a(()=>[r("div",_o,[r("a",{class:"item-details",onClick:T=>l.editProducto(s)},[r("div",null,[r("div",null,n(s.codigo)+", "+n(s.articulo),1),r("div",null,n(s.cantidad)+" x "+n(Number(s.precio).toFixed(2))+" €",1)]),r("div",fo,n(Number(s.euros).toFixed(2))+" €",1)],8,vo)])]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1}),e(A,{visible:o.add_producto,"onUpdate:visible":c[6]||(c[6]=s=>o.add_producto=s),title:"add","confirm-loading":l.confirmLoading,onOk:l.saveProducto},{footer:a(()=>[r("div",go,[o.isEdit!=""?(g(),z(m,{key:0,size:"large",type:"primary",danger:"",onClick:c[5]||(c[5]=s=>l.deleteProducto(o.codigo))},{default:a(()=>[d(n(o.$t("delect")),1)]),_:1})):O("",!0),e(m,{class:X({"center-button":o.isEdit==""}),key:"submit",type:"primary",size:"large",onClick:l.saveProducto},{default:a(()=>[d(n(o.$t("save")),1)]),_:1},8,["class","onClick"])])]),default:a(()=>[e(u,null,{default:a(()=>[e(i,{span:5},{default:a(()=>[d(n(o.$t("cantidad"))+"：",1)]),_:1}),e(i,{span:17},{default:a(()=>[e(k,{value:o.cantidad,"onUpdate:value":c[1]||(c[1]=s=>o.cantidad=s),class:"text-right",spellcheck:"false",onInput:l.validateNumberInput},null,8,["value","onInput"])]),_:1})]),_:1}),e(u,null,{default:a(()=>[e(i,{span:5},{default:a(()=>[d(n(o.$t("precio"))+":",1)]),_:1}),e(i,{span:17},{default:a(()=>[e(k,{value:o.precio,"onUpdate:value":c[2]||(c[2]=s=>o.precio=s),class:"text-right",spellcheck:"false",onBlur:l.checkInput,onInput:l.validatePrecioInput},null,8,["value","onBlur","onInput"])]),_:1})]),_:1}),e(u,null,{default:a(()=>[e(i,{span:5},{default:a(()=>[d(n(o.$t("codigo"))+":",1)]),_:1}),e(i,{span:17},{default:a(()=>[e(k,{value:o.codigo,"onUpdate:value":c[3]||(c[3]=s=>o.codigo=s),class:"text-right",spellcheck:"false"},null,8,["value"])]),_:1})]),_:1}),e(N,{value:o.articulo,"onUpdate:value":c[4]||(c[4]=s=>o.articulo=s),"show-search":"",placeholder:"Select",style:{width:"100%"},options:l.articulo_list},null,8,["value","options"])]),_:1},8,["visible","confirm-loading","onOk"])],64)}const ho=Q(ao,[["render",mo],["__scopeId","data-v-b5222c02"]]);export{ho as default};
